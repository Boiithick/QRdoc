<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Create Cards</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 40px;
      text-align: center;
    }
    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: inline-block;
    }
    input, button {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 80%;
      max-width: 400px;
    }
    #qrcode {
      margin-top: 20px;
    }
    #cardList {
      margin-top: 30px;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .card-entry {
      background: #eaeaea;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>
  <div class="container" id="login-container">
    <h2>Admin Login</h2>
    <input type="password" id="admin-password" placeholder="Enter password">
    <button onclick="checkPassword()">Login</button>
  </div>

  <div class="container" id="admin-panel" style="display:none;">
    <h2>Create a New Card</h2>
    <input type="text" id="question" placeholder="Question">
    <input type="text" id="a1" placeholder="Answer 1 (Correct)">
    <input type="text" id="a2" placeholder="Answer 2 (Wrong)">
    <input type="text" id="a3" placeholder="Answer 3 (Wrong)">
    <button onclick="createCard()">Generate Link & QR Code</button>

    <div id="linkOutput"></div>
    <canvas id="qrcode"></canvas>

    <div id="cardList">
      <h3>Created Cards</h3>
      <div id="cards"></div>
    </div>
  </div>

  <script>
    const correctPassword = "admin123"; // Change this to your actual password
    let cards = JSON.parse(localStorage.getItem("cards")) || [];

    function checkPassword() {
      const input = document.getElementById("admin-password").value;
      if (input === correctPassword) {
        document.getElementById("login-container").style.display = "none";
        document.getElementById("admin-panel").style.display = "block";
        renderCardList();
      } else {
        alert("Incorrect password");
      }
    }

    function generateGameLink(cardData) {
      const { question, a1, a2, a3 } = cardData;
      const query = new URLSearchParams({ question, a1, a2, a3 }).toString();
      
      // This generates the relative URL directly
      return `/game.html?${query}`;
    }

    function createCard() {
      const question = document.getElementById("question").value;
      const a1 = document.getElementById("a1").value;
      const a2 = document.getElementById("a2").value;
      const a3 = document.getElementById("a3").value;

      if (!question || !a1 || !a2 || !a3) {
        alert("Please fill in all fields.");
        return;
      }

      const url = generateGameLink({ question, a1, a2, a3 });
      const fullUrl = window.location.origin + url;  // Ensures the full URL includes the domain

      document.getElementById("linkOutput").innerHTML = `
        <p><strong>Game Link:</strong> <a href="${url}" target="_blank">${fullUrl}</a></p>
      `;

      // Create the QR code using the full URL
      QRCode.toCanvas(document.getElementById('qrcode'), fullUrl, function (error) {
        if (error) console.error(error);
        console.log('QR code generated!');
      });

      // Save the card info to local storage
      const newCard = { question, a1, a2, a3, url: fullUrl };
      cards.push(newCard);
      localStorage.setItem("cards", JSON.stringify(cards));
      renderCardList();
    }

    function renderCardList() {
      const container = document.getElementById("cards");
      container.innerHTML = "";
      cards.forEach((card, index) => {
        const div = document.createElement("div");
        div.className = "card-entry";
        div.innerHTML = `
          <strong>Q${index + 1}:</strong> ${card.question}<br>
          <a href="${card.url}" target="_blank">${card.url}</a><br>
          <button onclick="deleteCard(${index})">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    function deleteCard(index) {
      cards.splice(index, 1);
      localStorage.setItem("cards", JSON.stringify(cards));
      renderCardList();
    }
  </script>
</body>
</html>
